<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MediChat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap & FontAwesome -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    rel="stylesheet"
  />

  <!-- Custom CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
</head>
<body>
  <div class="container-fluid h-100">
    <div class="row justify-content-center h-100">
      <div class="col-12 col-md-10 col-lg-8 col-xl-6 chat-container">
        <div class="card glass-card">

          <!-- header -->
          <div class="card-header chat-header">
            <div class="d-flex align-items-center">
              <div class="avatar-container">
                <img
                  src="https://cdn-icons-png.flaticon.com/512/387/387569.png"
                  class="bot-avatar"
                />
                <span class="online-status"></span>
              </div>
              <div class="header-text">
                <h2 class="bot-name">MediChat Assistant</h2>
                <p class="bot-status">Online â€¢ Ready to help</p>
              </div>
            </div>
          </div>

          <!-- messages -->
          <div id="messageFormeight" class="card-body message-container">
            {{ chat_container }}
          </div>

          <!-- input -->
          <!-- <div class="card-footer chat-input-container">
            <form id="messageArea" class="input-group">
              <input
                type="text"
                id="text"
                class="form-control chat-input"
                placeholder="Type your message..."
                autocomplete="off"
                required
              />
              <button class="btn send-button" type="submit">
                <i class="fas fa-paper-plane"></i>
              </button>
            </form>
          </div> -->
        </div>
      </div>
    </div>
  </div>

  <!-- jQuery & Bootstrap bundle -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
  ></script>

  <!-- Chat logic -->
  <script>
    const $msgContainer = $("#messageFormeight");

    function scrollToBottom() {
      $msgContainer.stop().animate(
        { scrollTop: $msgContainer[0].scrollHeight },
        600
      );
    }

    function getCurrentTime() {
      const d = new Date();
      let h = d.getHours(),
          m = d.getMinutes(),
          ampm = h >= 12 ? "PM" : "AM";
      h = h % 12 || 12;
      m = m < 10 ? "0" + m : m;
      return h + ":" + m + " " + ampm;
    }

    $("#messageArea").on("submit", function (e) {
      e.preventDefault();
      const raw = $("#text").val().trim();
      if (!raw) return;

      const time = getCurrentTime();

      const userMsg = $(`
        <div class="message-user d-flex justify-content-end mb-4">
          <div class="message-content">
            <p>${raw}</p>
            <span class="message-time">${time}</span>
          </div>
          <div class="avatar-container">
            <img
              src="https://i.ibb.co/d5b84Xw/Untitled-design.png"
              class="user-avatar rounded-circle"
            />
          </div>
        </div>
      `);
      $msgContainer.append(userMsg);
      $("#text").val("");
      scrollToBottom();

      // Send message to Streamlit backend
      if (window.parent) {
        window.parent.postMessage({ user_input: raw }, "*");
      }
    });
  </script>
</body>
</html>
